===============================================
===============================================
{
  "version": "1.5.0",
  "binaryVersion": "2.0.0",                       // KH√îNG ƒê·ªîI
  "binaryPackage": "HTCasinoEntry_v2.0.0.zip",    // KH√îNG ƒê·ªîI
  "configVersion": "1.5.0",                       // ‚úÖ CONFIG M·ªöI
  "configPackage": "HTCasinoEntry_config_v1.5.0.zip", // ‚úÖ CONFIG PACKAGE
  "configMergeStrategy": "selective",             // ‚úÖ CHI·∫æN L∆Ø·ª¢C
  "configFiles": [                                // ‚úÖ FILE POLICIES
    {
      "name": "appsettings.json",
      "updatePolicy": "merge",
      "priority": "server"
    },
    {
      "name": "database.config",
      "updatePolicy": "preserve",
      "priority": "local"
    },
    {
      "name": "logging.config",
      "updatePolicy": "replace",
      "priority": "server"
    }
  ],
  "updateType": "config",                         // ‚úÖ CH·ªà UPDATE CONFIG
  "forceUpdate": false,
  "notifyUser": true,
  "allowSkip": true,
  "updateDescription": "Updated API endpoints and configurations",
  "releaseNotes": "- New API endpoints\n- Updated timeout settings",
  "isStable": true
}

===============================================
===============================================
{
  "status": 200,
  "success": true,
  "data": {
    "appCode": "HTCasinoEntry",
    "binary": {
      "version": "2.0.0",
      "package": "HTCasinoEntry_v2.0.0.zip",
      "files": []
    },
    "config": {
      "version": "1.5.0",                    // ‚úÖ NEW VERSION
      "package": "HTCasinoEntry_config_v1.5.0.zip",
      "mergeStrategy": "selective",
      "files": [
        {
          "name": "appsettings.json",
          "updatePolicy": "merge",
          "priority": "server"
        },
        {
          "name": "database.config",
          "updatePolicy": "preserve",
          "priority": "local"
        }
      ]
    },
    "updatePolicy": {
      "type": "config",                      // ‚úÖ CH·ªà CONFIG
      "force": false,
      "notifyUser": true,
      "allowSkip": true,
      "description": "Updated API endpoints"
    }
  }
}

===============================================
===============================================
C:\CompanyApps\HTCasinoEntry\
‚îú‚îÄ‚îÄ App\
‚îÇ   ‚îú‚îÄ‚îÄ HTCasinoEntry.exe      (KH√îNG ƒê·ªîI)
‚îÇ   ‚îú‚îÄ‚îÄ HTCasinoEntry.dll      (KH√îNG ƒê·ªîI)
‚îÇ   ‚îî‚îÄ‚îÄ version.txt            (2.0.0 - KH√îNG ƒê·ªîI)
‚îú‚îÄ‚îÄ Config\
‚îÇ   ‚îú‚îÄ‚îÄ appsettings.json       (‚úÖ MERGED - c√≥ key m·ªõi)
‚îÇ   ‚îú‚îÄ‚îÄ database.config        (‚úÖ PRESERVED - gi·ªØ nguy√™n)
‚îÇ   ‚îú‚îÄ‚îÄ logging.config         (‚úÖ REPLACED - file m·ªõi)
‚îÇ   ‚îú‚îÄ‚îÄ features.json          (‚úÖ ADDED - file m·ªõi)
‚îÇ   ‚îî‚îÄ‚îÄ version.txt            (‚úÖ 1.5.0 - UPDATED)
‚îî‚îÄ‚îÄ manifest.json              (‚úÖ UPDATED)

===============================================
===============================================
using ClientLauncher.Services;

public class ConfigUpdateTester
{
    private readonly IManifestService _manifestService;
    private readonly ISelectiveUpdateService _selectiveUpdateService;
    
    public async Task TestConfigOnlyUpdate()
    {
        var appCode = "HTCasinoEntry";
        
        // 1. Get manifest
        Console.WriteLine("=== Step 1: Fetch Manifest ===");
        var manifest = await _manifestService.GetManifestFromServerAsync(appCode);
        Console.WriteLine($"Update Type: {manifest.UpdatePolicy.Type}");
        Console.WriteLine($"Binary Version: {manifest.Binary.Version}");
        Console.WriteLine($"Config Version: {manifest.Config.Version}");
        
        // 2. Check local versions
        Console.WriteLine("\n=== Step 2: Check Local Versions ===");
        var localBinaryVersion = ReadVersion($@"C:\CompanyApps\{appCode}\App\version.txt");
        var localConfigVersion = ReadVersion($@"C:\CompanyApps\{appCode}\Config\version.txt");
        Console.WriteLine($"Local Binary: {localBinaryVersion}");
        Console.WriteLine($"Local Config: {localConfigVersion}");
        
        // 3. Determine update type
        Console.WriteLine("\n=== Step 3: Determine Update ===");
        var needBinaryUpdate = IsNewer(manifest.Binary.Version, localBinaryVersion);
        var needConfigUpdate = IsNewer(manifest.Config.Version, localConfigVersion);
        
        Console.WriteLine($"Need Binary Update: {needBinaryUpdate}");
        Console.WriteLine($"Need Config Update: {needConfigUpdate}");
        
        // 4. Apply config update only
        if (needConfigUpdate && !needBinaryUpdate)
        {
            Console.WriteLine("\n=== Step 4: Applying Config Update ===");
            
            // Download config package
            var configPath = await DownloadConfig(appCode, manifest.Config.Package);
            Console.WriteLine($"Downloaded: {configPath}");
            
            // Apply selective update
            var result = await _selectiveUpdateService.ApplySelectiveConfigUpdateAsync(
                appCode, 
                manifest, 
                configPath
            );
            
            if (result)
            {
                Console.WriteLine("‚úÖ Config updated successfully!");
                
                // Update version.txt
                File.WriteAllText(
                    $@"C:\CompanyApps\{appCode}\Config\version.txt",
                    manifest.Config.Version
                );
                
                Console.WriteLine($"‚úÖ Config version.txt updated to {manifest.Config.Version}");
            }
            else
            {
                Console.WriteLine("‚ùå Config update failed!");
            }
        }
        
        // 5. Verify
        Console.WriteLine("\n=== Step 5: Verification ===");
        VerifyConfigFiles(appCode);
    }
    
    private void VerifyConfigFiles(string appCode)
    {
        var configPath = $@"C:\CompanyApps\{appCode}\Config";
        
        Console.WriteLine("\nConfig Files:");
        foreach (var file in Directory.GetFiles(configPath))
        {
            var fileName = Path.GetFileName(file);
            var lastModified = File.GetLastWriteTime(file);
            Console.WriteLine($"  - {fileName} (Modified: {lastModified})");
        }
        
        // Check merged content
        var appSettingsPath = Path.Combine(configPath, "appsettings.json");
        if (File.Exists(appSettingsPath))
        {
            Console.WriteLine("\nMerged appsettings.json:");
            var content = File.ReadAllText(appSettingsPath);
            Console.WriteLine(content);
        }
    }
    
    private string ReadVersion(string path)
    {
        return File.Exists(path) ? File.ReadAllText(path).Trim() : "0.0.0";
    }
    
    private bool IsNewer(string serverVer, string localVer)
    {
        try
        {
            return new Version(serverVer) > new Version(localVer);
        }
        catch
        {
            return serverVer != localVer;
        }
    }
    
    private async Task<string> DownloadConfig(string appCode, string packageName)
    {
        var url = $"https://localhost:7102/api/apps/{appCode}/download/{packageName}";
        var tempPath = Path.Combine(Path.GetTempPath(), packageName);
        
        using var client = new HttpClient();
        var data = await client.GetByteArrayAsync(url);
        await File.WriteAllBytesAsync(tempPath, data);
        
        return tempPath;
    }
}
===============================================
===============================================
üéØ T√ìM T·∫ÆT QUY TR√åNH
‚úÖ Upload Config:
1.	ƒê√≥ng g√≥i config files v√†o .zip
2.	POST /api/PackageManagement/upload v·ªõi PackageType="Config"
3.	Server l∆∞u v√†o Packages/{AppCode}/config_vX.X.X.zip
‚úÖ Create Manifest:
1.	POST /api/ApplicationManagement/{id}/manifest
2.	Set updateType="config"
3.	Ch·ªâ ƒë·ªãnh configPackage v√† configMergeStrategy
‚úÖ Client Update:
1.	GET manifest ‚Üí check updateType
2.	N·∫øu type="config" ‚Üí ch·ªâ download config package
3.	Apply selective update theo merge strategy
4.	Update Config/version.txt
5.	Restart app (kh√¥ng c·∫ßn update binary)
===============================================
===============================================